<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mubasic</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000;
            color: #b3b3b3;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .container {
            background-color: #121212;
            border-radius: 1rem;
            margin: 0.5rem auto;
            padding: 1rem;
            max-width: 100%;
            min-height: 100vh;
        }
        @media (min-width: 640px) {
            .container {
                max-width: 95%;
                min-height: calc(100vh - 1rem);
            }
        }
        .song-card {
            background-color: #181818;
            border-radius: 0.5rem;
            padding: 1rem;
            transition: background-color 0.3s ease, transform 0.2s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .song-card:hover {
            background-color: #282828;
            transform: translateY(-5px);
        }
        .play-overlay {
            position: absolute;
            bottom: 1.5rem;
            right: 1.5rem;
            width: 3rem;
            height: 3rem;
            background-color: #1db954;
            color: #121212;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            cursor: pointer;
        }
        .song-card:hover .play-overlay {
            opacity: 1;
            transform: translateY(0);
        }
        .play-overlay:hover {
            transform: scale(1.1) translateY(0);
        }
        .admin-btn {
            background-color: #1db954;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 700;
            letter-spacing: 0.05em;
            transition: background-color 0.3s ease;
        }
        .admin-btn:hover {
            background-color: #1ed760;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .slide-up {
            animation: slideUp 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        .slide-down {
            animation: slideDown 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        @keyframes slideDown {
            from { transform: translateY(0); }
            to { transform: translateY(100%); }
        }
        /* Scrollbar stilini koyu temaya göre ayarlar */
        ::-webkit-scrollbar {
            width: 12px;
        }
        ::-webkit-scrollbar-track {
            background: #121212;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #535353;
            border-radius: 6px;
            border: 3px solid #121212;
        }
        ::-webkit-scrollbar-thumb:hover {
            background-color: #6d6d6d;
        }
        .nav-link {
            transition: color 0.3s ease;
        }
        .nav-link.active {
            color: #fff;
        }
        .nav-link:hover {
            color: #fff;
        }
    </style>
</head>
<body class="bg-black text-white flex flex-col min-h-screen">
    <main class="flex-1">
        <div id="app" class="container w-full">
            <!-- Mesaj Kutusu -->
            <div id="message-box" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden items-center justify-center z-50">
                <div class="bg-gray-800 rounded-lg p-6 max-w-sm mx-auto shadow-2xl">
                    <p id="message-text" class="text-white text-center mb-4"></p>
                    <button onclick="hideMessage()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Kapat</button>
                </div>
            </div>

            <!-- Tam Ekran Müzik Çalar -->
            <div id="full-screen-player" class="fixed inset-0 bg-black bg-opacity-95 z-40 hidden flex-col items-center justify-center p-8">
                <button onclick="hideFullScreenPlayer()" class="absolute top-4 left-4 text-white text-2xl p-2 rounded-full hover:bg-gray-800 transition-colors">
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="w-full max-w-sm md:max-w-md lg:max-w-lg space-y-8 text-center">
                    <div class="relative w-full aspect-square bg-gray-700 rounded-lg shadow-lg flex items-center justify-center">
                        <i class="fas fa-music text-6xl text-gray-500"></i>
                    </div>
                    <div>
                        <h2 id="player-title" class="text-3xl sm:text-4xl font-bold text-white mb-1 truncate">Şarkı Adı</h2>
                        <p id="player-artist" class="text-xl text-gray-400 truncate">Sanatçı Adı</p>
                    </div>
                    <div class="flex justify-center items-center space-x-6">
                        <button onclick="seekBackward()" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fas fa-backward-step text-3xl"></i>
                        </button>
                        <button onclick="seekBackward(10)" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fas fa-rotate-left text-3xl"></i>
                        </button>
                        <button id="full-screen-play-pause" class="bg-white rounded-full w-20 h-20 flex items-center justify-center transition-transform hover:scale-105">
                            <i id="full-screen-play-icon" class="fas fa-play text-black text-3xl"></i>
                            <i id="full-screen-pause-icon" class="fas fa-pause text-black text-3xl hidden"></i>
                        </button>
                        <button onclick="seekForward(10)" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fas fa-rotate-right text-3xl"></i>
                        </button>
                        <button onclick="seekForward()" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fas fa-forward-step text-3xl"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Ana Ekran -->
            <div id="main-content" class="fade-in pb-20">
                <header class="flex flex-col sm:flex-row justify-between items-center mb-8">
                    <h1 class="text-4xl sm:text-5xl font-extrabold text-white mb-4 sm:mb-0">Mubasic</h1>
                    <!-- Admin Paneli linki buraya taşındı -->
                    <a href="#" onclick="showPanel('admin-login-screen')" class="text-sm text-gray-400 hover:text-white transition-colors font-medium">Admin Paneli</a>
                </header>

                <!-- Arama Çubuğu -->
                <div class="mb-8">
                    <div class="relative">
                        <input type="text" id="search-input" placeholder="Müzik Ara..." class="w-full p-4 pl-12 rounded-full bg-gray-800 text-white placeholder-gray-500 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                        <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"></i>
                    </div>
                </div>
                
                <!-- İçerik Bölümleri -->
                <div id="content-home" class="tab-content">
                    <h2 class="text-2xl font-bold text-white mb-4">Senin İçin</h2>
                    <div id="song-list" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 sm:gap-6">
                        <!-- Müzikler buraya JavaScript ile eklenecek -->
                    </div>
                    <div id="empty-message" class="text-center text-gray-500 text-lg mt-8 hidden">
                        Henüz hiç müzik eklenmedi. Yönetici panelinden eklemeye başlayın!
                    </div>
                </div>

                <div id="content-favorites" class="tab-content hidden">
                    <h2 class="text-2xl font-bold text-white mb-4">Favorilerin</h2>
                    <div id="favorites-list" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 sm:gap-6">
                        <!-- Favori şarkılar buraya eklenecek -->
                    </div>
                    <div id="empty-favorites-message" class="text-center text-gray-500 text-lg mt-8 hidden">
                        Favori şarkınız yok. Birkaç tane ekleyin!
                    </div>
                </div>

                <div id="content-downloads" class="tab-content hidden">
                    <h2 class="text-2xl font-bold text-white mb-4">İndirilenler</h2>
                    <div id="downloads-list" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 sm:gap-6">
                        <!-- İndirilen şarkılar buraya eklenecek -->
                    </div>
                    <div id="empty-downloads-message" class="text-center text-gray-500 text-lg mt-8 hidden">
                        İndirilen şarkınız yok. Birkaç tane indirin!
                    </div>
                </div>
            </div>

            <!-- Yönetici Girişi Ekranı -->
            <div id="admin-login-screen" class="hidden flex-col items-center justify-center p-8 space-y-6">
                <h2 class="text-4xl font-bold text-white">Yönetici Girişi</h2>
                <form id="login-form" class="w-full max-w-sm space-y-4">
                    <input type="password" id="admin-password" placeholder="Şifre" class="w-full p-4 rounded-lg border-2 border-gray-700 bg-gray-800 text-white focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                    <button type="submit" class="w-full admin-btn">Giriş Yap</button>
                </form>
            </div>

            <!-- Yönetici Paneli Ekranı -->
            <div id="admin-panel-screen" class="hidden space-y-6">
                <header class="flex justify-between items-center mb-6">
                    <h2 class="text-4xl font-bold text-white">Yönetici Paneli</h2>
                    <button onclick="logout()" class="text-sm text-red-400 hover:text-red-600 font-medium">Çıkış Yap</button>
                </header>
                
                <form id="upload-form" class="bg-gray-800 p-6 rounded-xl space-y-4 shadow-inner">
                    <h3 class="text-xl font-semibold text-white">Yeni Şarkı Ekle</h3>
                    <p class="text-sm text-gray-400 mb-4">
                        <span class="font-bold text-white">Önemli:</span> YouTube veya SoundCloud gibi bir platformdan **doğrudan müzik URL'si** yapıştırın.
                    </p>
                    <input type="text" id="song-title" placeholder="Şarkı Adı" class="w-full p-3 rounded-lg border-2 border-gray-700 bg-gray-900 text-white focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                    <input type="text" id="song-artist" placeholder="Sanatçı Adı" class="w-full p-3 rounded-lg border-2 border-gray-700 bg-gray-900 text-white focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                    <input type="url" id="song-url" placeholder="Müzik URL'si (Örn: youtube.com/watch?v=...)" class="w-full p-3 rounded-lg border-2 border-gray-700 bg-gray-900 text-white focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                    <button type="submit" class="w-full admin-btn">Şarkıyı Ekle</button>
                </form>
                
                <div class="p-6 bg-gray-800 rounded-xl shadow-md">
                    <h3 class="text-xl font-semibold text-white mb-4">Mevcut Şarkılar</h3>
                    <ul id="admin-song-list" class="space-y-4">
                        <!-- Şarkı listesi buraya gelecek -->
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <!-- Alt Navigasyon Çubuğu -->
    <footer id="bottom-nav" class="fixed bottom-0 left-0 right-0 z-50 bg-gray-900 border-t border-gray-800">
        <div class="flex justify-around items-center h-16">
            <button onclick="showTab('home')" class="nav-link flex flex-col items-center justify-center p-2 text-gray-400 active">
                <i class="fas fa-home text-xl"></i>
                <span class="text-xs mt-1">Ana Sayfa</span>
            </button>
            <button onclick="showTab('favorites')" class="nav-link flex flex-col items-center justify-center p-2 text-gray-400">
                <i class="fas fa-heart text-xl"></i>
                <span class="text-xs mt-1">Favoriler</span>
            </button>
            <button onclick="showTab('downloads')" class="nav-link flex flex-col items-center justify-center p-2 text-gray-400">
                <i class="fas fa-arrow-down text-xl"></i>
                <span class="text-xs mt-1">İndirilenler</span>
            </button>
        </div>
    </footer>
    
    <audio id="audio-player" class="hidden"></audio>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, deleteDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Ortam tarafından sağlanan global değişkenler
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Firebase Başlangıç
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        let currentUserId = null;

        // UI Elementleri
        const mainContent = document.getElementById('main-content');
        const adminLoginScreen = document.getElementById('admin-login-screen');
        const adminPanelScreen = document.getElementById('admin-panel-screen');
        const fullScreenPlayer = document.getElementById('full-screen-player');
        const loginForm = document.getElementById('login-form');
        const uploadForm = document.getElementById('upload-form');
        const searchInput = document.getElementById('search-input');
        const songList = document.getElementById('song-list');
        const favoritesList = document.getElementById('favorites-list');
        const downloadsList = document.getElementById('downloads-list');
        const adminSongList = document.getElementById('admin-song-list');
        const emptyMessage = document.getElementById('empty-message');
        const emptyFavoritesMessage = document.getElementById('empty-favorites-message');
        const emptyDownloadsMessage = document.getElementById('empty-downloads-message');
        const audioPlayer = document.getElementById('audio-player');
        const playerTitle = document.getElementById('player-title');
        const playerArtist = document.getElementById('player-artist');
        const fullScreenPlayPauseBtn = document.getElementById('full-screen-play-pause');
        const fullScreenPlayIcon = document.getElementById('full-screen-play-icon');
        const fullScreenPauseIcon = document.getElementById('full-screen-pause-icon');
        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');

        // Durum değişkenleri
        let isLoggedIn = false;
        let currentSong = null;
        let allSongs = [];
        let favorites = [];
        let downloads = [];

        // Firebase Kimlik Doğrulama ve Veri Dinleme
        // onAuthStateChanged, kullanıcı oturum durumu değiştiğinde çalışır.
        // Uygulama ilk yüklendiğinde de bir kez çalışarak mevcut durumu verir.
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // Kullanıcı oturum açtıysa veya zaten oturum açmışsa
                currentUserId = user.uid;

                // Genel müzik listesini dinle
                const musicCollectionRef = collection(db, `artifacts/${appId}/public/data/songs`);
                onSnapshot(musicCollectionRef, (snapshot) => {
                    allSongs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderSongList();
                    updateFavoritesAndDownloads();
                    if (isLoggedIn) {
                        renderAdminSongList();
                    }
                });

                // Favori ve indirme listelerini dinle
                const favoritesCollectionRef = collection(db, `artifacts/${appId}/users/${currentUserId}/favorites`);
                onSnapshot(favoritesCollectionRef, (snapshot) => {
                    favorites = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    if (!document.getElementById('content-favorites').classList.contains('hidden')) {
                         renderFavorites();
                    }
                });

                const downloadsCollectionRef = collection(db, `artifacts/${appId}/users/${currentUserId}/downloads`);
                onSnapshot(downloadsCollectionRef, (snapshot) => {
                    downloads = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    if (!document.getElementById('content-downloads').classList.contains('hidden')) {
                        renderDownloads();
                    }
                });

            } else {
                // Kullanıcı oturum açmadıysa
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (error) {
                    console.error("Firebase'e bağlanırken hata oluştu:", error);
                    showMessage("Uygulama başlatılırken bir sorun oluştu.");
                }
            }
        });

        // Yeni: Arama işlevi eklendi
        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const filteredSongs = allSongs.filter(song =>
                song.title.toLowerCase().includes(query) ||
                song.artist.toLowerCase().includes(query)
            );
            renderSongList(filteredSongs);
        });

        function updateFavoritesAndDownloads() {
            // Favoriler ve indirmeler listesini en güncel tüm şarkı verileriyle senkronize et
            favorites = favorites.map(fav => allSongs.find(song => song.id === fav.id)).filter(Boolean);
            downloads = downloads.map(dl => allSongs.find(song => song.id === dl.id)).filter(Boolean);
        }

        // Yeni: Tam ekran oynatıcı kontrolleri
        fullScreenPlayPauseBtn.addEventListener('click', () => {
            if (audioPlayer.paused) {
                audioPlayer.play();
                fullScreenPlayIcon.classList.add('hidden');
                fullScreenPauseIcon.classList.remove('hidden');
            } else {
                audioPlayer.pause();
                fullScreenPlayIcon.classList.remove('hidden');
                fullScreenPauseIcon.classList.add('hidden');
            }
        });

        audioPlayer.addEventListener('play', () => {
            fullScreenPlayIcon.classList.add('hidden');
            fullScreenPauseIcon.classList.remove('hidden');
        });

        audioPlayer.addEventListener('pause', () => {
            fullScreenPlayIcon.classList.remove('hidden');
            fullScreenPauseIcon.classList.add('hidden');
        });

        window.seekBackward = (seconds = 5) => {
            audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - seconds);
        };

        window.seekForward = (seconds = 5) => {
            audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + seconds);
        };

        /**
         * Tüm tam ekran katmanlarını gizler.
         */
        function hideAllOverlays() {
            fullScreenPlayer.classList.add('hidden');
            fullScreenPlayer.classList.remove('flex', 'flex-col');
            messageBox.classList.add('hidden');
            messageBox.classList.remove('flex');
        }

        /**
         * Tüm ana panelleri yöneten merkezi fonksiyon.
         */
        window.showPanel = (panelId) => {
            hideAllOverlays(); // Yeni: Herhangi bir geçişten önce tüm katmanları gizle
            const panels = [mainContent, adminLoginScreen, adminPanelScreen];
            const targetPanel = document.getElementById(panelId);

            panels.forEach(panel => {
                panel.classList.add('hidden');
                panel.classList.remove('flex', 'flex-col', 'fade-in');
            });
            
            targetPanel.classList.remove('hidden');
            targetPanel.classList.add('flex', 'flex-col', 'fade-in');

            if (panelId === 'main-content') {
                showTab('home');
            }
        };

        /**
         * main-content içinde sekmeler arası geçişi yöneten fonksiyon.
         */
        window.showTab = (tabId) => {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById('content-' + tabId).classList.remove('hidden');
            document.querySelectorAll('.nav-link').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.nav-link i.fa-${tabId === 'home' ? 'home' : tabId === 'favorites' ? 'heart' : 'arrow-down'}`).parentElement.classList.add('active');
            
            // Sekme değiştirildiğinde ilgili render fonksiyonunu çağır
            if (tabId === 'home') {
                 renderSongList();
            } else if (tabId === 'favorites') {
                renderFavorites();
            } else if (tabId === 'downloads') {
                renderDownloads();
            }
        };
        
        window.showFullScreenPlayer = async (songId) => {
            const songDocRef = doc(db, `artifacts/${appId}/public/data/songs`, songId);
            const songDocSnap = await getDoc(songDocRef);

            if (!songDocSnap.exists()) {
                showMessage("Şarkı bulunamadı.");
                return;
            }

            const song = { id: songDocSnap.id, ...songDocSnap.data() };
            currentSong = song;

            playerTitle.innerText = song.title;
            playerArtist.innerText = song.artist;
            fullScreenPlayer.classList.remove('hidden');
            fullScreenPlayer.classList.add('flex', 'slide-up');
            
            audioPlayer.src = song.url; // URL'yi doğru şekilde kullan
            audioPlayer.play().catch(e => {
                console.error("Müzik çalınamadı:", e);
                showMessage("Müzik çalınamadı. Lütfen URL'yi kontrol edin veya tarayıcı izinlerinizi güncelleyin.");
            });
        };

        window.hideFullScreenPlayer = () => {
            audioPlayer.pause();
            fullScreenPlayer.classList.add('slide-down');
            setTimeout(() => {
                fullScreenPlayer.classList.remove('slide-down', 'flex');
                fullScreenPlayer.classList.add('hidden');
            }, 500);
        };

        window.showMessage = (message) => {
            messageText.innerText = message;
            messageBox.classList.remove('hidden');
            messageBox.classList.add('flex');
        };

        window.hideMessage = () => {
            messageBox.classList.add('hidden');
            messageBox.classList.remove('flex');
        };
        
        // --- Render Fonksiyonları ---
        function renderSongList(filteredSongs = allSongs) {
            songList.innerHTML = '';
            if (filteredSongs.length === 0) {
                emptyMessage.classList.remove('hidden');
            } else {
                emptyMessage.classList.add('hidden');
            }

            filteredSongs.forEach(song => {
                const songEl = document.createElement('div');
                songEl.className = 'song-card';
                songEl.innerHTML = `
                    <div class="relative w-full aspect-square bg-gray-700 rounded-lg flex items-center justify-center">
                        <i class="fas fa-music text-4xl text-gray-500"></i>
                        <button class="play-overlay" onclick="event.stopPropagation(); showFullScreenPlayer('${song.id}')">
                            <i class="fas fa-play text-2xl"></i>
                        </button>
                    </div>
                    <div class="w-full mt-4">
                        <h4 class="text-lg font-medium text-white truncate">${song.title}</h4>
                        <p class="text-sm text-gray-400 truncate">${song.artist}</p>
                    </div>
                    <div class="flex mt-4 space-x-2">
                        <button onclick="event.stopPropagation(); addFavorite('${song.id}')" class="text-gray-400 hover:text-red-500 transition-colors">
                            <i class="fas fa-heart text-xl"></i>
                        </button>
                        <button onclick="event.stopPropagation(); addToDownloads('${song.id}')" class="text-gray-400 hover:text-green-500 transition-colors">
                            <i class="fas fa-download text-xl"></i>
                        </button>
                    </div>
                `;
                songList.appendChild(songEl);
            });
        }

        function renderAdminSongList() {
            adminSongList.innerHTML = '';
            if (allSongs.length === 0) {
                adminSongList.innerHTML = '<li class="text-gray-500 text-center">Henüz eklenmiş müzik yok.</li>';
            }
            allSongs.forEach(song => {
                const li = document.createElement('li');
                li.className = 'flex items-center justify-between p-4 bg-gray-700 rounded-lg';
                li.innerHTML = `
                    <div>
                        <p class="font-semibold text-white">${song.title}</p>
                        <p class="text-sm text-gray-400">${song.artist}</p>
                    </div>
                    <button onclick="deleteSong('${song.id}')" class="text-red-400 hover:text-red-600 font-medium">
                        <i class="fas fa-trash"></i> Sil
                    </button>
                `;
                adminSongList.appendChild(li);
            });
        }
        
        function renderFavorites() {
            favoritesList.innerHTML = '';
            if (favorites.length === 0) {
                emptyFavoritesMessage.classList.remove('hidden');
            } else {
                emptyFavoritesMessage.classList.add('hidden');
                favorites.forEach(song => {
                    const songEl = document.createElement('div');
                    songEl.className = 'song-card';
                    songEl.onclick = () => showFullScreenPlayer(song.id);
                    songEl.innerHTML = `
                        <div class="relative w-full aspect-square bg-gray-700 rounded-lg flex items-center justify-center">
                            <i class="fas fa-heart text-4xl text-red-500"></i>
                            <button class="play-overlay" onclick="event.stopPropagation(); showFullScreenPlayer('${song.id}')">
                                <i class="fas fa-play text-2xl"></i>
                            </button>
                        </div>
                        <div class="w-full mt-4">
                            <h4 class="text-lg font-medium text-white truncate">${song.title}</h4>
                            <p class="text-sm text-gray-400 truncate">${song.artist}</p>
                        </div>
                    `;
                    favoritesList.appendChild(songEl);
                });
            }
        }
        
        function renderDownloads() {
            downloadsList.innerHTML = '';
            if (downloads.length === 0) {
                emptyDownloadsMessage.classList.remove('hidden');
            } else {
                emptyDownloadsMessage.classList.add('hidden');
                downloads.forEach(song => {
                    const songEl = document.createElement('div');
                    songEl.className = 'song-card';
                    songEl.onclick = () => showFullScreenPlayer(song.id);
                    songEl.innerHTML = `
                        <div class="relative w-full aspect-square bg-gray-700 rounded-lg flex items-center justify-center">
                            <i class="fas fa-arrow-down text-4xl text-gray-500"></i>
                            <button class="play-overlay" onclick="event.stopPropagation(); showFullScreenPlayer('${song.id}')">
                                <i class="fas fa-play text-2xl"></i>
                            </button>
                        </div>
                        <div class="w-full mt-4">
                            <h4 class="text-lg font-medium text-white truncate">${song.title}</h4>
                            <p class="text-sm text-gray-400 truncate">${song.artist}</p>
                        </div>
                    `;
                    downloadsList.appendChild(songEl);
                });
            }
        }

        // --- Çekirdek Uygulama Mantığı ---
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const password = document.getElementById('admin-password').value;
            if (password === '1975') {
                isLoggedIn = true;
                showPanel('admin-panel-screen');
                renderAdminSongList();
            } else {
                showMessage("Yanlış şifre. Lütfen tekrar deneyin.");
            }
        });

        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const title = document.getElementById('song-title').value.trim();
            const artist = document.getElementById('song-artist').value.trim();
            const url = document.getElementById('song-url').value.trim();

            if (!title || !artist || !url) {
                showMessage("Lütfen tüm alanları doldurun.");
                return;
            }
            
            try {
                await addDoc(collection(db, `artifacts/${appId}/public/data/songs`), {
                    title: title,
                    artist: artist,
                    url: url,
                    createdAt: new Date()
                });
                showMessage("Şarkı başarıyla eklendi!");
                uploadForm.reset();
            } catch (e) {
                console.error("Şarkı eklenirken hata oluştu: ", e);
                showMessage("Şarkı eklenirken bir hata oluştu.");
            }
        });

        window.deleteSong = async (songId) => {
            try {
                await deleteDoc(doc(db, `artifacts/${appId}/public/data/songs`, songId));
                showMessage("Şarkı başarıyla silindi!");
            } catch (e) {
                console.error("Şarkı silinirken hata oluştu: ", e);
                showMessage("Şarkı silinirken bir hata oluştu.");
            }
        };

        window.logout = () => {
            isLoggedIn = false;
            showPanel('main-content');
        };

        window.addFavorite = async (songId) => {
            if (!currentUserId) {
                showMessage("Favori eklemek için oturum açmalısınız.");
                return;
            }
            try {
                const docRef = doc(db, `artifacts/${appId}/users/${currentUserId}/favorites`, songId);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    showMessage("Bu şarkı zaten favorilerinizde.");
                } else {
                    await setDoc(docRef, { songId: songId, createdAt: new Date() });
                    showMessage("Şarkı favorilere eklendi!");
                }
            } catch (e) {
                console.error("Favori eklenirken hata oluştu: ", e);
                showMessage("Favori eklenirken bir hata oluştu.");
            }
        };

        window.addToDownloads = async (songId) => {
            if (!currentUserId) {
                showMessage("İndirmek için oturum açmalısınız.");
                return;
            }
            try {
                const docRef = doc(db, `artifacts/${appId}/users/${currentUserId}/downloads`, songId);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    showMessage("Bu şarkı zaten indirilmiş.");
                } else {
                    await setDoc(docRef, { songId: songId, createdAt: new Date() });
                    showMessage("Şarkı indirilenlere eklendi!");
                }
            } catch (e) {
                console.error("İndirilenlere eklenirken hata oluştu: ", e);
                showMessage("İndirilenlere eklenirken bir hata oluştu.");
            }
        };

        window.onload = function() {
            // İlk görünümü ayarla
            showPanel('main-content');
        };
    </script>
</body>
</html>
