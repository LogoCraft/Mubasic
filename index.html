<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobil Kod Düzenleyici</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #0f172a;
            color: #e2e8f0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .container {
            display: flex;
            flex-grow: 1;
            overflow: hidden;
        }
        .sidebar {
            width: 300px;
            background-color: #1e293b;
            border-right: 1px solid #334155;
            flex-shrink: 0;
            transition: transform 0.3s ease-in-out;
            transform: translateX(-100%);
            z-index: 20;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            flex-direction: column;
            padding: 1rem;
        }
        @media (min-width: 768px) {
            .sidebar {
                transform: translateX(0);
                position: relative;
            }
        }
        .sidebar.active {
            transform: translateX(0);
        }
        .editor-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        .file-item {
            cursor: pointer;
            padding: 0.75rem 1rem;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-radius: 0.5rem;
        }
        .file-item:hover {
            background-color: #334155;
        }
        .file-item.active {
            background-color: #475569;
            font-weight: bold;
        }
        .icon {
            margin-right: 0.5rem;
        }
        .delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #ef4444;
            padding: 0.5rem;
            transition: color 0.2s;
        }
        .delete-btn:hover {
            color: #fca5a5;
        }
        .bottom-bar {
            background-color: #1e293b;
            border-top: 1px solid #334155;
            display: flex;
            justify-content: center;
            padding: 0.5rem;
        }
        .tab-bar {
            display: flex;
            background-color: #1e293b;
            border-bottom: 1px solid #334155;
        }
        .tab {
            padding: 1rem 2rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            font-weight: 600;
        }
        .tab:hover {
            background-color: #334155;
        }
        .tab.active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
        }
        .editor-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .editor-tab-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
        }
        .editor-tab-content.active {
            display: flex;
        }
        #html-editor, #js-editor {
            flex-grow: 1;
            width: 100%;
            background-color: #0f172a;
            color: #f8fafc;
            font-family: monospace;
            padding: 1rem;
            resize: none;
            outline: none;
            border: none;
            line-height: 1.5;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 flex flex-col h-screen">

    <!-- Top Bar - Title and Sidebar Toggle -->
    <header class="bg-gray-800 p-2 flex items-center shadow-md z-10">
        <button id="toggle-sidebar" class="p-2 rounded-lg hover:bg-gray-700 focus:outline-none md:hidden">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
            </svg>
        </button>
        <h1 class="text-xl font-bold ml-2">Mobil Kod Düzenleyici</h1>
    </header>

    <div class="container relative">
        <!-- Sidebar for File Explorer -->
        <aside id="sidebar" class="sidebar absolute md:relative flex flex-col p-4 z-10 top-0 left-0 bottom-0">
            <h2 class="text-lg font-semibold mb-4">Dosyalar</h2>
            <div id="file-list" class="flex-grow overflow-y-auto">
                <!-- Dosya öğeleri buraya eklenecek -->
            </div>
        </aside>

        <!-- Main Editor Area -->
        <main class="editor-area">
            <!-- Tab Bar for HTML and JS -->
            <div class="tab-bar">
                <div id="html-tab" class="tab active">HTML</div>
                <div id="js-tab" class="tab">JavaScript</div>
            </div>
            
            <div class="editor-container">
                <!-- HTML Editor -->
                <div id="html-editor-container" class="editor-tab-content active">
                    <textarea id="html-editor" spellcheck="false" class="bg-gray-900 text-gray-200 p-4"></textarea>
                </div>
                <!-- JavaScript Editor -->
                <div id="js-editor-container" class="editor-tab-content">
                    <textarea id="js-editor" spellcheck="false" class="bg-gray-900 text-gray-200 p-4"></textarea>
                </div>
            </div>
        </main>
    </div>

    <!-- Message box for alerts and prompts -->
    <div id="message-box" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-sm">
            <div id="message-text" class="text-center text-lg mb-4"></div>
            <input type="text" id="prompt-input" class="w-full p-2 mb-4 rounded bg-gray-700 text-white hidden" placeholder="Dosya adını girin...">
            <div class="flex justify-center space-x-4">
                <button id="ok-btn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 focus:outline-none hidden">Tamam</button>
                <button id="confirm-btn" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 focus:outline-none hidden">Onayla</button>
            </div>
        </div>
    </div>

    <!-- Bottom Bar - Controls -->
    <div class="bottom-bar">
        <div class="flex items-center space-x-4">
            <button id="new-file-btn" class="p-3 rounded-lg bg-gray-700 hover:bg-gray-600 focus:outline-none flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
                Yeni Dosya
            </button>
            <button id="save-btn" class="p-3 rounded-lg bg-blue-600 hover:bg-blue-700 focus:outline-none flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4 0V5a2 2 0 012-2h2a2 2 0 012 2v2m-4 0h0m-4 0h0" />
                </svg>
                Kaydet
            </button>
            <button id="run-btn" class="p-3 rounded-lg bg-green-600 hover:bg-green-700 focus:outline-none flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.26a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                Çalıştır
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const htmlEditor = document.getElementById('html-editor');
            const jsEditor = document.getElementById('js-editor');
            const htmlTab = document.getElementById('html-tab');
            const jsTab = document.getElementById('js-tab');
            const htmlEditorContainer = document.getElementById('html-editor-container');
            const jsEditorContainer = document.getElementById('js-editor-container');
            const fileListContainer = document.getElementById('file-list');
            const newFileBtn = document.getElementById('new-file-btn');
            const saveBtn = document.getElementById('save-btn');
            const runBtn = document.getElementById('run-btn');
            const sidebar = document.getElementById('sidebar');
            const toggleSidebarBtn = document.getElementById('toggle-sidebar');
            
            const messageBox = document.getElementById('message-box');
            const messageText = document.getElementById('message-text');
            const promptInput = document.getElementById('prompt-input');
            const okBtn = document.getElementById('ok-btn');
            const confirmBtn = document.getElementById('confirm-btn');

            let files = [];
            let activeFileIndex = -1;
            let activeTab = 'html';

            const showMessage = (text) => {
                return new Promise(resolve => {
                    messageText.textContent = text;
                    promptInput.classList.add('hidden');
                    okBtn.classList.remove('hidden');
                    confirmBtn.classList.add('hidden');
                    messageBox.classList.remove('hidden');

                    const handleOk = () => {
                        messageBox.classList.add('hidden');
                        okBtn.removeEventListener('click', handleOk);
                        resolve(true);
                    };
                    okBtn.addEventListener('click', handleOk);
                });
            };

            const showPrompt = (text, defaultValue = '') => {
                return new Promise(resolve => {
                    messageText.textContent = text;
                    promptInput.value = defaultValue;
                    promptInput.classList.remove('hidden');
                    okBtn.classList.add('hidden');
                    confirmBtn.classList.remove('hidden');
                    messageBox.classList.remove('hidden');

                    const handleConfirm = () => {
                        messageBox.classList.add('hidden');
                        confirmBtn.removeEventListener('click', handleConfirm);
                        resolve(promptInput.value);
                    };
                    confirmBtn.addEventListener('click', handleConfirm);
                });
            };

            const getIconForFile = (filename) => {
                if (filename.endsWith('.html')) return '📄';
                if (filename.endsWith('.js') || filename.endsWith('.jsx')) return '🚀';
                if (filename.endsWith('.py')) return '🐍';
                if (filename.endsWith('.md')) return '📝';
                if (filename.endsWith('.css')) return '🎨';
                return '📁';
            };

            const loadFilesFromStorage = () => {
                try {
                    const storedFiles = localStorage.getItem('code_editor_files');
                    if (storedFiles) {
                        files = JSON.parse(storedFiles);
                    }
                } catch (e) {
                    console.error("Dosyalar yüklenirken hata oluştu:", e);
                    files = [];
                }
            };

            const saveFilesToStorage = () => {
                localStorage.setItem('code_editor_files', JSON.stringify(files));
            };

            const renderFileList = () => {
                fileListContainer.innerHTML = '';
                files.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = `file-item rounded-lg mb-1 transition-all ${index === activeFileIndex ? 'active' : ''}`;
                    fileItem.dataset.index = index;
                    fileItem.innerHTML = `<span class="icon">${getIconForFile(file.name)}</span> ${file.name}
                                          <button class="delete-btn" data-index="${index}">
                                              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                              </svg>
                                          </button>`;
                    fileListContainer.appendChild(fileItem);
                });
            };

            const openFile = (index) => {
                if (index < 0 || index >= files.length) return;
                updateActiveFileContent();
                activeFileIndex = index;
                const file = files[activeFileIndex];
                
                // HTML ve JS içeriklerini ayırma
                const htmlContentMatch = file.content.match(/<html[\s\S]*>([\s\S]*)<\/html>/);
                const scriptContentMatch = file.content.match(/<script>([\s\S]*)<\/script>/);
                
                htmlEditor.value = htmlContentMatch ? `<html lang="tr">${htmlContentMatch[1]}</html>` : file.content;
                jsEditor.value = scriptContentMatch ? scriptContentMatch[1] : '';

                renderFileList();
                if (window.innerWidth <= 768) {
                    sidebar.classList.remove('active');
                }
            };

            const updateActiveFileContent = () => {
                if (activeFileIndex > -1) {
                    const htmlCode = htmlEditor.value;
                    const jsCode = jsEditor.value;
                    const combinedCode = htmlCode.replace(/<\/body>/, `<script>${jsCode}<\/script></body>`);
                    files[activeFileIndex].content = combinedCode;
                    saveFilesToStorage();
                }
            };

            toggleSidebarBtn.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });

            newFileBtn.addEventListener('click', async () => {
                const newFileName = await showPrompt('Yeni dosya adını girin (ör: script.html):');
                if (newFileName) {
                    const fileExists = files.some(file => file.name === newFileName);
                    if (fileExists) {
                        showMessage('Bu isimde bir dosya zaten var.');
                        return;
                    }
                    const newFileContent = `<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yeni Sayfa</title>
</head>
<body>
    <h1>Salam! Bu yeni fayldır.</h1>
</body>
</html>`;
                    files.push({
                        name: newFileName,
                        content: newFileContent
                    });
                    saveFilesToStorage();
                    openFile(files.length - 1);
                }
            });

            saveBtn.addEventListener('click', () => {
                if (activeFileIndex > -1) {
                    updateActiveFileContent();
                    showMessage('Değişiklikler kaydedildi!');
                } else {
                    showMessage('Lütfen önce bir dosya oluşturun veya açın.');
                }
            });

            runBtn.addEventListener('click', () => {
                if (activeFileIndex > -1) {
                    const combinedCode = files[activeFileIndex].content;
                    const blob = new Blob([combinedCode], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    window.open(url, '_blank');
                } else {
                    showMessage('Lütfen önce bir dosya oluşturun veya açın.');
                }
            });

            htmlEditor.addEventListener('input', updateActiveFileContent);
            jsEditor.addEventListener('input', updateActiveFileContent);
            
            htmlTab.addEventListener('click', () => {
                htmlTab.classList.add('active');
                jsTab.classList.remove('active');
                htmlEditorContainer.classList.add('active');
                jsEditorContainer.classList.remove('active');
                activeTab = 'html';
            });

            jsTab.addEventListener('click', () => {
                jsTab.classList.add('active');
                htmlTab.classList.remove('active');
                jsEditorContainer.classList.add('active');
                htmlEditorContainer.classList.remove('active');
                activeTab = 'js';
            });

            fileListContainer.addEventListener('click', async (event) => {
                const item = event.target.closest('.file-item');
                if (!item) return;
                
                if (event.target.closest('.delete-btn')) {
                    const index = parseInt(event.target.closest('.delete-btn').dataset.index, 10);
                    files.splice(index, 1);
                    saveFilesToStorage();
                    if (activeFileIndex === index) {
                        activeFileIndex = -1;
                        htmlEditor.value = '';
                        jsEditor.value = '';
                    } else if (activeFileIndex > index) {
                        activeFileIndex--;
                    }
                    renderFileList();
                } else {
                    const index = parseInt(item.dataset.index, 10);
                    openFile(index);
                }
            });

            loadFilesFromStorage();
            if (files.length === 0) {
                const newFileContent = `<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merhaba Dünya</title>
</head>
<body>
    <h1>Salam Dünya!</h1>
    <p>Bu sizin ilk faylınızdır.</p>
</body>
</html>`;
                files.push({
                    name: 'index.html',
                    content: newFileContent
                });
                saveFilesToStorage();
            }
            openFile(0);
        });
    </script>
</body>
</html>
